(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Leaflet maps API must be included *before* this code
*/
(function(){var p={}.hasOwnProperty,q=[].slice;null!=this.L&&(this.OverlappingMarkerSpiderfier=function(){function m(b,c){var a,e,f,g;this.map=b;null==c&&(c={});for(a in c)p.call(c,a)&&(e=c[a],this[a]=e);this.initMarkerArrays();this.listeners={};g=["click","zoomend"];e=0;for(f=g.length;e<f;e++)a=g[e],this.map.addEventListener(a,function(b){return function(){return b.unspiderfy()}}(this))}var d,k;d=m.prototype;d.VERSION="0.2.6";k=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=
9;d.circleFootSeparation=25;d.circleStartAngle=k/12;d.spiralFootSeparation=28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legWeight=1.5;d.legColors={usual:"#222",highlighted:"#f00"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(b){var c;if(null!=b._oms)return this;b._oms=!0;c=function(a){return function(){return a.spiderListener(b)}}(this);b.addEventListener("click",c);this.markerListeners.push(c);this.markers.push(b);return this};d.getMarkers=
function(){return this.markers.slice(0)};d.removeMarker=function(b){var c,a;null!=b._omsData&&this.unspiderfy();c=this.arrIndexOf(this.markers,b);if(0>c)return this;a=this.markerListeners.splice(c,1)[0];b.removeEventListener("click",a);delete b._oms;this.markers.splice(c,1);return this};d.clearMarkers=function(){var b,c,a,e,f;this.unspiderfy();f=this.markers;b=a=0;for(e=f.length;a<e;b=++a)c=f[b],b=this.markerListeners[b],c.removeEventListener("click",b),delete c._oms;this.initMarkerArrays();return this};
d.addListener=function(b,c){var a;(null!=(a=this.listeners)[b]?a[b]:a[b]=[]).push(c);return this};d.removeListener=function(b,c){var a;a=this.arrIndexOf(this.listeners[b],c);0>a||this.listeners[b].splice(a,1);return this};d.clearListeners=function(b){this.listeners[b]=[];return this};d.trigger=function(){var b,c,a,e,f,g;c=arguments[0];b=2<=arguments.length?q.call(arguments,1):[];c=null!=(a=this.listeners[c])?a:[];g=[];e=0;for(f=c.length;e<f;e++)a=c[e],g.push(a.apply(null,b));return g};d.generatePtsCircle=
function(b,c){var a,e,f,g,d;f=this.circleFootSeparation*(2+b)/k;e=k/b;d=[];for(a=g=0;0<=b?g<b:g>b;a=0<=b?++g:--g)a=this.circleStartAngle+a*e,d.push(new L.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)));return d};d.generatePtsSpiral=function(b,c){var a,e,f,g,d;f=this.spiralLengthStart;a=0;d=[];for(e=g=0;0<=b?g<b:g>b;e=0<=b?++g:--g)a+=this.spiralFootSeparation/f+5E-4*e,e=new L.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)),f+=k*this.spiralLengthFactor/a,d.push(e);return d};d.spiderListener=function(b){var c,
a,e,f,g,d,h,k,l;(c=null!=b._omsData)&&this.keepSpiderfied||this.unspiderfy();if(c)return this.trigger("click",b);f=[];g=[];d=this.nearbyDistance*this.nearbyDistance;e=this.map.latLngToLayerPoint(b.getLatLng());l=this.markers;h=0;for(k=l.length;h<k;h++)c=l[h],this.map.hasLayer(c)&&(a=this.map.latLngToLayerPoint(c.getLatLng()),this.ptDistanceSq(a,e)<d?f.push({marker:c,markerPt:a}):g.push(c));return 1===f.length?this.trigger("click",b):this.spiderfy(f,g)};d.makeHighlightListeners=function(b){return{highlight:function(c){return function(){return b._omsData.leg.setStyle({color:c.legColors.highlighted})}}(this),
unhighlight:function(c){return function(){return b._omsData.leg.setStyle({color:c.legColors.usual})}}(this)}};d.spiderfy=function(b,c){var a,e,f,g,d,h,k,l,m,n;this.spiderfying=!0;n=b.length;a=this.ptAverage(function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)k=b[a],e.push(k.markerPt);return e}());g=n>=this.circleSpiralSwitchover?this.generatePtsSpiral(n,a).reverse():this.generatePtsCircle(n,a);a=function(){var a,c,k;k=[];a=0;for(c=g.length;a<c;a++)f=g[a],e=this.map.layerPointToLatLng(f),m=this.minExtract(b,
function(a){return function(b){return a.ptDistanceSq(b.markerPt,f)}}(this)),h=m.marker,d=new L.Polyline([h.getLatLng(),e],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.map.addLayer(d),h._omsData={usualPosition:h.getLatLng(),leg:d},this.legColors.highlighted!==this.legColors.usual&&(l=this.makeHighlightListeners(h),h._omsData.highlightListeners=l,h.addEventListener("mouseover",l.highlight),h.addEventListener("mouseout",l.unhighlight)),h.setLatLng(e),h.setZIndexOffset(1E6),k.push(h);
return k}.call(this);delete this.spiderfying;this.spiderfied=!0;return this.trigger("spiderfy",a,c)};d.unspiderfy=function(b){var c,a,e,f,d,k,h;null==b&&(b=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;f=[];e=[];h=this.markers;d=0;for(k=h.length;d<k;d++)c=h[d],null!=c._omsData?(this.map.removeLayer(c._omsData.leg),c!==b&&c.setLatLng(c._omsData.usualPosition),c.setZIndexOffset(0),a=c._omsData.highlightListeners,null!=a&&(c.removeEventListener("mouseover",a.highlight),c.removeEventListener("mouseout",
a.unhighlight)),delete c._omsData,f.push(c)):e.push(c);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",f,e);return this};d.ptDistanceSq=function(b,c){var a,e;a=b.x-c.x;e=b.y-c.y;return a*a+e*e};d.ptAverage=function(b){var c,a,e,d,g;d=a=e=0;for(g=b.length;d<g;d++)c=b[d],a+=c.x,e+=c.y;b=b.length;return new L.Point(a/b,e/b)};d.minExtract=function(b,c){var a,d,f,g,k,h;f=k=0;for(h=b.length;k<h;f=++k)if(g=b[f],g=c(g),"undefined"===typeof a||null===a||g<d)d=g,a=f;return b.splice(a,
1)[0]};d.arrIndexOf=function(b,c){var a,d,f,g;if(null!=b.indexOf)return b.indexOf(c);a=f=0;for(g=b.length;f<g;a=++f)if(d=b[a],d===c)return a;return-1};return m}())}).call(this);}).call(this);
/* Sa 3 Jan 2015 18:46:15 CET */
